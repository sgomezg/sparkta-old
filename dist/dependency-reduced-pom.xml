<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <parent>
    <artifactId>parent</artifactId>
    <groupId>com.stratio.sparkta</groupId>
    <version>0.0.1-SNAPSHOT</version>
  </parent>
  <modelVersion>4.0.0</modelVersion>
  <artifactId>dist</artifactId>
  <build>
    <plugins>
      <plugin>
        <artifactId>maven-deploy-plugin</artifactId>
        <version>2.8.1</version>
        <configuration>
          <skip>true</skip>
        </configuration>
      </plugin>
    </plugins>
  </build>
  <profiles>
    <profile>
      <id>package</id>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>appassembler-maven-plugin</artifactId>
            <version>1.8.1</version>
            <executions>
              <execution>
                <id>engine</id>
                <phase>package</phase>
                <goals>
                  <goal>assemble</goal>
                </goals>
                <configuration>
                  <configurationSourceDirectory>${config.directory}</configurationSourceDirectory>
                  <configurationDirectory>:/etc/sds/sparkta/conf</configurationDirectory>
                  <copyConfigurationDirectory>true</copyConfigurationDirectory>
                  <includeConfigurationDirectoryInClasspath>true</includeConfigurationDirectoryInClasspath>
                  <assembleDirectory>target/appassembler</assembleDirectory>
                  <extraJvmArguments>$SPARKTA_OPTS -Xms512m -Xmx512m
                                        -Dcom.sun.management.jmxremote.port=7193
                                        -Dcom.sun.management.jmxremote.authenticate=false
                                        -Dcom.sun.management.jmxremote.ssl=false</extraJvmArguments>
                  <filterConfigurationDirectory>true</filterConfigurationDirectory>
                  <programs>
                    <program>
                      <mainClass>${driver.mainclass}</mainClass>
                      <id>run</id>
                    </program>
                  </programs>
                  <platforms>
                    <platform>unix</platform>
                  </platforms>
                </configuration>
              </execution>
            </executions>
          </plugin>
          <plugin>
            <groupId>com.stratio.mojo.unix</groupId>
            <artifactId>unix-maven-plugin</artifactId>
            <version>1.1.2</version>
            <extensions>true</extensions>
            <executions>
              <execution>
                <id>engine</id>
                <phase>package</phase>
                <goals>
                  <goal>package-deb</goal>
                  <goal>package-rpm</goal>
                </goals>
                <configuration>
                  <name>Engine</name>
                  <size>1</size>
                  <assembly>
                    <copyDirectory>
                      <from>target/appassembler/bin</from>
                      <to>/opt/sds/sparkta/bin</to>
                    </copyDirectory>
                    <copyDirectory>
                      <from>target/appassembler/repo</from>
                      <to>/opt/sds/sparkta/repo</to>
                    </copyDirectory>
                    <copyDirectory>
                      <from>target/appassembler/:/etc/sds/sparkta/conf</from>
                      <to>/etc/sds/sparkta/conf</to>
                    </copyDirectory>
                  </assembly>
                </configuration>
              </execution>
            </executions>
            <inherited>false</inherited>
            <configuration>
              <contact>Stratio SpaRkTA&lt;sparkta@stratio.com&gt;</contact>
              <contactEmail>sparkta@stratio.com</contactEmail>
              <deb>
                <section>devel</section>
              </deb>
              <rpm>
                <group>stratio</group>
              </rpm>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>
  <dependencies>
    <dependency>
      <groupId>org.scalatest</groupId>
      <artifactId>scalatest_2.10</artifactId>
      <version>2.2.2</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
  <properties>
    <classpath.directory>lib</classpath.directory>
    <binary.name>sparkta-${project.version}</binary.name>
    <config.directory>src/main/resources</config.directory>
    <driver.mainclass>com.stratio.sparkta.driver.Sparkta</driver.mainclass>
    <outputFileName>stratio-sparkta</outputFileName>
    <plugins.directory>plugins</plugins.directory>
  </properties>
</project>

